<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>EMS-ESP Installer</title>
    <script type="module" src="https://unpkg.com/esp-web-tools@10.0.1/dist/web/install-button.js?module"></script>
    <style></style>
  </head>

  <body style="background-color: #133746">
    <script>
      async function fetchLatestTag() {
        const repo = "emsesp/EMS-ESP32";
        const url = `https://api.github.com/repos/${repo}/tags`;

        try {
          const response = await fetch(url);
          const data = await response.json();
          const latestTag = data[0].name; // Get the name of the latest tag
          document.getElementById("latest-tag").innerText = latestTag;
        } catch (error) {
          console.error("Error fetching the latest tag:", error);
          document.getElementById("latest-tag").innerText = "Error fetching tag";
        }
      }
      fetchLatestTag();
    </script>

    <div class="container" style="height: 100%">
      <div class="jumbotron" style="width: 100%; height: 75%">
        <h1 class="display-3">EMS-ESP Installer</h1>

        <div class="d-flex flex-grow-1 align-items-center">
          <h6><strong>Install the latest EMS-ESP firmware onto a BBQKees Electronics Gateway board</strong>&nbsp;</h6>
          <object data="images/emsesp.png" width="30" height="30"></object>
          <img src="images/r-arrow.png" width="40" height="20" />
          <object data="images/bbqkees.svg" width="30" height="30"></object>
        </div>

        <p class="text-secondary mt-3">
          This will download and install the current stable version which is
          <strong><span id="latest-tag"></span></strong>. You can always decide later to upgrade to the development
          releases from within the EMS-ESP WebUI.
        </p>

        <div class="alert alert-dismissible alert-warning">
          To use, attach the Gateway device directly to your computer using a USB cable, choose the model below and then
          click&nbsp;
          <esp-web-install-button id="button_web_install" manifest="artifacts/manifest">
            <button type="button" class="btn btn-primary" slot="activate">Connect</button>
            <span slot="not-allowed">
              <div class="alert alert-dismissible alert-danger">
                <div class="col text-center">
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button><strong>Not Allowed</strong>
                </div>
                <div>Flashing is only supported from the local host or from a secure web site.</div>
              </div>
            </span>
            <span slot="notsupported">
              <div class="alert alert-dismissible alert-danger">
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button
                ><strong>Browser Not Supported</strong>
                <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API#browser_compatibility"
                  >Make sure you are using a compatible browser</a
                >
              </div>
            </span>
          </esp-web-install-button>
        </div>
      </div>

      <div id="latest-tag"></div>

      <div id="device_tiles">
        <div class="d-flex flex-row">
          <div class="card bg-light mx-auto" style="max-width: 20rem" role="button">
            <div class="card-header bg-primary" role="button" id="cardS3_header" manifest="artifacts/manifest-S3.json">
              <input id="cardS3" type="radio" checked="" /><label for="cardS3">&nbsp;Gateway S3</label>
            </div>
            <div class="card-body">
              <p class="card-text">
                The EMS Gateway S3 (Standard Edition V3.0, WiFi), running on an ESP32-S3 dual-core with 16MB Flash + 4MB
                PSRAM
              </p>
              <p></p>
              <img src="images/S3.jpg" width="100%" />
              <a href="https://bbqkees-electronics.nl/product/gateway-s3-standard-wifi-edition"
                >Gateway S3 (Standard WiFi Edition V3)</a
              >
            </div>
          </div>

          <div class="card bg-light mx-auto" style="max-width: 20rem" role="button">
            <div class="card-header" role="button" id="cardE32V2_header" manifest="artifacts/manifest-E32V2.json">
              <input id="cardE32V2" type="radio" /><label for="cardE32V2">&nbsp;Gateway E32</label>
            </div>
            <div class="card-body">
              <p class="card-text">
                The new Gateway E32 V2, supporting both Ethernet and WiFi, running on an ESP32 dual-core with 16MB Flash
                + 8MB PSRAM
              </p>
              <p></p>
              <img src="images/E32V2.jpg" width="100%" />
              <a href="https://bbqkees-electronics.nl/product/gateway-e32-v2-ethernet-wifi-edition-v2"
                >Gateway E32 V2 (Ethernet + WiFi Edition V2)</a
              >
            </div>
          </div>
        </div>
      </div>

      <!-- <div style="height: 75%">
        <div class="panel panel-default">
          <div class="panel-body">
            <ul id="platforms_tabs" class="nav nav-tabs" role="tablist"></ul>
            <div id="firmware_content" class="tab-content"></div>
            <div class="accordion" id="platforms"></div>
          </div>
        </div>
      </div> -->

      <hr class="mt-3" style="color: #ffffff" />

      <footer class="text-center">
        <a href="https://github.com/emsesp/EMS-ESP32">EMS-ESP32</a>
        &nbsp;&vert;&nbsp;
        <a href="https://bbqkees-electronics.nl/wiki/">BBQKees Electronics</a>
      </footer>
    </div>
  </body>
</html>
